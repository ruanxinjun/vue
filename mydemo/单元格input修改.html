<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<meta name=description content="">
	<meta name=viewport content="width=device-width, initial-scale=1">
	<title></title>
	<script src="lib/vue.js"></script>
	<script src="lib/vue-resource.js"></script>
	<script src="lib/jquery-1.7.2.js"></script>
    <script src="lib/bootstrap.min.js"></script>
	<link rel="stylesheet" type="text/css" href="lib/bootstrap.min.css"/>
	<style>
	.myhead{border-radius:0px;width:100%;margin-top:10px;}
	.modal.fade.in {top: 30%;}
	.btn{padding:5px;border-radius:0px;font-size:9pt;}
	</style>
</head>
<body>
<div id="box" class="container">
<div class="alert alert-info myhead col-lg-12">
{{apptitle}}
</div>
<ol class="breadcrumb">
	<li>
		<a href="#" v-if="selitem.length>0" class="btn btn-sm btn-danger"  data-toggle="modal" data-target='#modal-id'>删除{{selitem.length}}条记录</a>
	</li>
	<li>
		<a href="#" class="btn btn-sm btn-success" @click="addstatus=addstatus?false:true">{{addstatus?'不录入':'录入'}}</a>
	</li>
	<li>
	<input type="text" v-model="skey"  width="200" placeholder="输入关键词" @keyup="ckall=false">
	</li>

</ol>
<div class="panel panel-default" v-if="addstatus">
	<div class="panel-body">
		录入新员工<hr/>
			<div class="col-lg-2">
			<label>姓名</label>
			</div>
			<div class="col-lg-2">
			<input type="text" class="form-control" v-model="models.name" ref="name"/>
			</div>
			<div class="col-lg-2">
			<label>工资</label>
			</div>
			<div class="col-lg-2">
			<input type="number" v-model="models.salary" ref="salary" name="" id="input" class="form-control" step="50" value="5000">	
			</div>
			<hr/>
			<div class="col-lg-10">
			<button type="button" class="btn btn-success btn-lg" @click="addnew">信息无误，确认添加新员工</button>
			<button type="button" class="btn btn-info btn-lg" @click="addstatus=false">取消</button>
			</div>
	</div>
</div>
<table class="table table-hover table-striped">
	<thead>
		<tr class="alert alert-success">
			<th><input type="checkbox"  @click="checkall" :checked="ckall"></th>
			<th>ID</th>
			<th>姓名</th>
			<th>工资</th>
			<th>编辑</th>
		</tr>
	</thead>
	<tbody>
		<tr v-for="(user,index) of userlist">
			<td><input type="checkbox" :value="user.id" :checked="user.checked" @click="chksing($event,user.id)"></td>
			<td>{{user.id}}</td>
			<td>{{user.name}}</td>
			<td>{{user.salary | rmb}}</td>
			<td>
				<button type="button" class="btn btn-info">编辑</button>
				<button type="button" data-toggle="modal" data-target='#modal-id' class="btn btn-danger" @click="seldata(user.id,index)">删除</button>
			</td>
		</tr>
		<tr>
			<td colspan="4" class="text-center">{{status}}</td>
		</tr>
	</tbody>
</table>
<div class="modal fade" id="modal-id"  data-backdrop="static">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">温馨提醒</h4>
			</div>
			<div class="modal-body">
				{{status}}
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" @click="cancel">取消</button>
				<button data-dismiss="modal" :disabled="selitem.length==0" type="button" class="btn btn-primary" @click="deldata">{{selitem.length>1?'全部删除':'删除'}}</button>
			</div>
		</div>
	</div>
</div>
</div>
<script>
	var app = new Vue({
		el:'#box',
		data:function(){
			return {
				addstatus:false,//录入状态，默认为否
				skey:'',//搜索关键词
				status:'',//状态
				ckall:false,
				apptitle:'员工信息列表',
				selitem:[],//选中的数据
				currindex:-1,//当前选中的索引
				//数据列表
				users:[
					{id:1001,name:'阮新军',salary:1500,checked:false},
					{id:2008,name:'别毛风',salary:2500,checked:false},
					{id:2511,name:'李小鲁',salary:3000,checked:false},
					{id:1571,name:'朱伟名',salary:4000,checked:false},
					{id:354,name:'龙立夏',salary:3200,checked:false},
					{id:95,name:'陈小龙',salary:1200,checked:false},
					{id:120,name:'许海新',salary:2500,checked:false}
				],
				//员工模型
				models:{
					name:'',
					salary:0
				}
			}
		},
		watch:{
			 //观察users里面checked的变化，动态为selitem注入选中的数据
			'users':{
				deep:true,
				handler:function(v){
					var _selitem = [];
					v.forEach(function(u){
						if(u.checked){
							_selitem.push(u);
						}
					});
					this.selitem = _selitem;
					this.status ='总计选中：'+this.selitem.length+' 条记录';
				}
			}
		},
		//筛选
		computed:{
			userlist:function(){
				var _skey = this.skey.trim();
				var _users = this.users;
				if(_skey!=''){
					var fduser = [];
					_users.forEach(function(item){
						item.checked=false;
						if(item.name.indexOf(_skey)!=-1){
							fduser.push(item);
						}
					});
					return fduser;
				}else{
					return _users; 
				}
			}
		},
		//过滤器
		filters:{
			rmb:function(v){
				return '¥'+v;
			}
		},
		methods:{
			//全选、反选
			checkall:function(event){
				var _users = this.users;
				if(event.currentTarget.checked){
					this.ckall=true;
					_users.forEach(function(u){
						u.checked=true;
					})
				}
				else
				{
					this.ckall=false;
					this.currindex = -1;
					_users.forEach(function(u){
						u.checked=false;
					})
				}
				this.users = _users;
			},
			//单个选中
			chksing:function(event,id){
				var _users = this.users;
				if(event.currentTarget.checked){
					_users.forEach(function(u){
						if(u.id==id){
							u.checked=true;
						}
					});
					event.currentTarget.checked = true;
				}
				else{
					_users.forEach(function(u){
						if(u.id==id){
							u.checked=false;
						}
					});
					event.currentTarget.checked = false;
				}
				this.users = _users;
				this.ckall = false;	
			},
			//添加
			addnew:function(){		
				var md = new Object();
				if(this.$refs.name.value!=''){
				md.id = this.users.length>0?(this.users[this.users.length-1].id+1):1000;
				md.name = this.models.name;
				md.salary = this.models.salary; 
				md.checked = false;
				this.users.push(md);
				this.models.name = '';
				this.models.salary = 0;
				this.ckall=false;
				this.addstatus= false;
				}else{
					this.$refs.name.focus();
				}
			},
			//删除
			deldata:function(){
				var _users = this.users;
				//获取需要删除的数据
				this.selitem.forEach(function(s){
					var index = _users.findIndex(function(f){
						return f.id == s.id;
					});
					_users.splice(index,1);
				});
				this.ckall=false;
				this.users = _users;
			},
			//选中单个数据
			seldata:function(id){
				var _users = this.users;
				var _index = this.currindex;
				_users.forEach(function(u,index){
					if(u.id==id){
						u.checked=true;
						_index = index;
					}
				});
				this.users = _users;
				this.currindex = _index;
			},
			//取消
			cancel:function(){
				this.ckall=false;
				var _users = this.users;
				_users.forEach(function(u,index){
					if(this.currindex!=-1){
						u.checked = this.currindex ==index;
					}else{
						u.checked=false;
					}
				});
				this.users = _users;
			}
		}
	});
</script>
</body>
</html>